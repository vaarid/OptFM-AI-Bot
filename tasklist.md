# Tasklist: OptFM AI Bot

## Прогресс
| Итерация | Описание | Статус |
|----------|----------|--------|
| 1 | Эхо-бот (MVP) | ✅ |
| 2 | Интеграция FAQ (статическая база) | ✅ |
| 3 | Подключение RAG (прайс OptFM) | ✅ |
| 3.1 | Интеграция RAG в Telegram бота | ✅ |
| 3.2 | Улучшение UX поиска | ✅ |
| 3.3 | Исправление багов | ✅ |
| 3.4 | Решение проблем запуска | ✅ |
| 4 | Интеграция с LLM (Ollama/российские AI) | ⬜ |
| 5 | Добавление памяти диалога | ⬜ |
| 6 | Логирование и мониторинг | ⬜ |
| 7 | Передача заявок менеджеру | ⬜ |
| 8 | Web-виджет (интеграция с сайтом) | ⬜ |
| 9 | Docker-контейнеризация | ⬜ |
| 10 | Документация и гайды | ⬜ |

---

## Итерации разработки

### Итерация 1: Эхо-бот (MVP)
- [x] Создать Telegram-бота
- [x] Настроить получение и отправку сообщений
- [x] Проверить базовую работу

### Итерация 2: Интеграция FAQ
- [x] Добавить статический FAQ (json/md)
- [x] Настроить поиск и выдачу ответов

### Итерация 3: Подключение RAG (прайс OptFM)
- [x] Загрузить прайс в ChromaDB
- [x] Настроить поиск по товарам и ценам
- [x] Создать парсер Excel файлов
- [x] Интегрировать sentence-transformers
- [x] Реализовать ProductRAGManager
- [x] Протестировать поиск товаров
- [x] Добавить поиск по производителям техники
- [x] Реализовать фильтрацию по производителям и ценовому диапазону

### Итерация 3.1: Интеграция RAG в Telegram бота
- [x] Добавить команду /search для поиска товаров
- [x] Интегрировать ProductRAGManager в бота
- [x] Создать интерактивные кнопки для результатов поиска
- [x] Добавить фильтры по категориям и производителям
- [x] Реализовать пагинацию результатов поиска
- [x] Добавить команду /categories для просмотра категорий
- [x] Добавить команду /manufacturers для просмотра производителей
- [x] Протестировать поиск товаров через бота

### Итерация 3.2: Улучшение UX поиска
- [x] Реализовать интерактивный поиск (бот запрашивает ввод после /search)
- [x] Улучшить алгоритм поиска для производителей
- [x] Добавить умное определение поисковых запросов
- [x] Создать кнопки популярных запросов
- [x] Исправить приветствие (убрать "Привет")
- [x] Добавить режим поиска с сохранением состояния
- [x] Протестировать улучшенный поиск

### Итерация 3.3: Исправление багов
- [x] Исправить баг с отображением неправильных товаров при клике на кнопки
- [x] Добавить метод get_product_by_id в ProductRAGManager
- [x] Изменить обработчик product_ callback'ов в боте
- [x] Протестировать исправление
- [x] Обновить документацию

### Итерация 3.4: Решение проблем запуска
- [x] Исправить конфликт экземпляров бота
- [x] Решить проблему с Button_data_invalid
- [x] Обеспечить корректную работу нового интерфейса
- [x] Создать процедуру перезапуска бота
- [x] Обновить документацию по устранению неполадок

### Итерация 4: Интеграция LLM
- [ ] Подключить Ollama
- [ ] Добавить поддержку ЯндексGPT/СберAI
- [ ] Реализовать универсальный клиент

### Итерация 5: Добавление памяти диалога
- [ ] Хранить контекст беседы в PostgreSQL
- [ ] Восстанавливать контекст при новом запросе

### Итерация 6: Логирование и мониторинг
- [ ] Настроить логирование в файл и БД
- [ ] Добавить Prometheus/Grafana метрики

### Итерация 7: Передача заявок менеджеру
- [ ] Реализовать форму сбора контактов
- [ ] Настроить запись в БД
- [ ] Уведомлять менеджера о новой заявке

### Итерация 8: Web-виджет
- [ ] Реализовать чат-виджет для сайта
- [ ] Подключить его к backend API

### Итерация 9: Docker-контейнеризация
- [ ] Написать Dockerfile
- [ ] Настроить docker-compose.yml

### Итерация 10: Документация и гайды
- [ ] Создать `docs/intro.md`
- [ ] Написать гайды по запуску и обновлению
- [ ] Добавить ADR для ключевых решений
