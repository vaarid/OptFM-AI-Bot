# Conventions: OptFM AI Bot

## Общие правила
- Следуем принципам **KISS** (Keep It Simple, Stupid) и **YAGNI** (You Aren’t Gonna Need It).
- Пишем только необходимый код, без оверинжиниринга.
- Код должен быть читаемым и поддерживаемым.

---

## Структура проекта
- Основная логика в `src/`
- Разделение по модулям: `api/`, `bot/`, `web/`, `rag/`, `db/`
- Документация в `docs/`
- Правила для Cursor в `.cursor/rules/`

---

## Правила кодирования
- Язык: **Python 3.11+**
- Стиль: PEP8 + type hints (аннотации типов)
- Форматирование: **black**
- Импорты: сортировать через **isort**
- Логирование: только через модуль `logging`, без `print()`

---

## Работа с LLM
- Все вызовы к LLM проходят через отдельный модуль `rag/llm_client.py`
- Поддерживаются только три провайдера: `ollama`, `yandex`, `sber`
- Перед вызовом LLM данные валидируются
- Ответы логируются в БД и в `logs/app.log`

---

## Работа с БД
- Используем **SQLAlchemy**
- Все миграции через **Alembic**
- Обязательные поля: `created_at`, `updated_at`

---

## Обработка ошибок
- Исключения всегда логируются
- Критические ошибки отправляются в `error.log`
- Нельзя замалчивать исключения (`except Exception: pass` запрещено)

---

## Документация
- Каждая функция снабжается docstring по формату Google-style
- Архитектурные решения фиксируем в `docs/ADR/`
- Руководства для пользователей и разработчиков храним в `docs/guides/`

---

## Git Workflow
- Основная ветка: `main`
- Для новых функций: `feature/*`
- Для исправлений: `fix/*`
- Перед merge — обязательно code review и автотесты

---

## Запрещено
- Хранить токены и пароли в коде (используем `.env`)
- Использовать неофициальные библиотеки без обсуждения
- Вносить изменения в `main` без pull request
